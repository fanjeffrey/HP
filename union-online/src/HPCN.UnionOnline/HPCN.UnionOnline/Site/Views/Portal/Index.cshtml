
@{
    ViewData["Title"] = $"My Portal";
    var myEnrollings = ViewBag.MyEnrollings as List<Enrolling>;
    var enrolleesInEnrollments = ViewBag.EnrolleesInEnrollments as Dictionary<Guid, int>;
}

<h2>My Portal</h2>

<div class="section">
    <fieldset>
        <legend>我已报名的活动</legend>
        <div>
            @if (myEnrollings.Any())
            {
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                活动名称
                            </th>
                            <th>报名开始</th>
                            <th>报名截止</th>
                            <th>报名人数</th>
                            <th>代报名</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in myEnrollings)
                {
                            <tr>
                                <td title="@item.Enrollment.Description">
                                    <span>@item.Enrollment.Name</span>
                                </td>
                                <td>
                                    @item.Enrollment.BeginTime
                                </td>
                                <td>
                                    @item.Enrollment.EndTime
                                </td>
                                <td>
                                    @(enrolleesInEnrollments[item.Enrollment.Id]) / @item.Enrollment.MaxCountOfEnrolles
                                </td>
                                <td>
                                    @(item.Enrollee.EmployeeNo == item.User.Employee.No ? " - " : $"<a href='mailto:{item.User.Employee.EmailAddress}'>{item.User.Employee.ChineseName} (#{item.User.Employee.No})</a>")
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p>你尚未报名参加任何活动。<a asp-controller="Home" asp-action="Enrollments">现在报名</a></p>
            }
        </div>
    </fieldset>
</div>